<div class="main">
  <ng-container *ngIf="!(globalLoading$ | async); else loading">
    <div class="main__header">
      <div class="toolbar">
        <tk-search
          (valueChange)="
            store.dispatch(ProductActions.search({ search: $event }))
          "
          [options]="searchOptions$ | async"
        ></tk-search>

        <tk-lang-selector
          (langChanged)="store.dispatch(LangActions.change({ lang: $event }))"
          [lang]="lang$ | async"
        ></tk-lang-selector>
      </div>
      <mat-divider></mat-divider>
    </div>

    <div class="product-list">
      <tk-product
        *ngFor="
          let product of topProducts$ | async | productSearch: (search$ | async)
        "
        [product]="product"
        class="product-list__item"
      ></tk-product>
    </div>

    <div>
      <tk-product-table
        [loading]="loading$ | async"
        [products]="products$ | async"
        [pageIndex]="pageIndex$ | async"
        [totalNumber]="totalNumber$ | async"
        [search]="search$ | async"
        (pageChange)="store.dispatch(ProductActions.changePage({pageIndex: $event}))"
      ></tk-product-table>
    </div>
  </ng-container>
</div>

<ng-template #loading>
  <div class="loader">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>
